<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="assets/styles.css">
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>
<table id="movie-data" name="movie-data">
    <tr>
        <th>Ann√©e</th>
        <th>Titre</th>
        <th>Image</th>
    </tr>
</table>
<input type="text" id="user-data" name="user-data" onclick=""/>
<br>
<button id="user-data-save">Save my choices</button>


<script>
    window.clearMindKaiserTrackingData = {};
    $(document).ready(function () {
        $.getJSON("input-formatted.json", function (json) {
            console.log("success");
            console.dir(json);
            window.clearMindKaiserTrackingData = json;
            console.log(document.getElementById("movie-data"));
            table = document.getElementById("movie-data");

            json.forEach(function (el, cpt) {
                row = table.insertRow(cpt);
                cell1 = row.insertCell(0);
                cell1.innerHTML = el.createdYear;
                cell2 = row.insertCell(1);
                cell2.innerHTML = el.title;
                cell3 = row.insertCell(2);
                cell3.outerHTML = '<img loading="lazy" alt="failed" scr="cache/' + el.picture_url.split('/').pop() + '">';
                console.log(cpt);
                console.log(el);
                console.log(row);
                console.log(table);
            });
        })
            .fail(function () {
                console.log("error");
            });

        $('#user-data-save').on('click', function () {
            const userInput = $('#user-data').val();
            console.dir(userInput);
            $.ajax({
                url: 'save.php',
                type: 'POST',
                data: {data: userInput},
                success: function (response) {
                    try {
                        const json = JSON.parse(response);
                        if (json.success) {
                            console.info("Saved successfully: " + json.message);
                        } else {
                            console.debug("Error: " + json.message);
                        }
                    } catch (e) {
                        console.error("Invalid JSON response from server.");
                    }
                },
                error: function () {
                    alert("AJAX request failed.");
                }
            });
        });
    });
</script>
</body>
</html>