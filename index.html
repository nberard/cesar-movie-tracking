<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="assets/styles.css">
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>
<table id="movie-data" name="movie-data">
    <tr>
        <th>Ann√©e</th>
        <th>Titre</th>
        <th>Image</th>
    </tr>
</table>
<input type="text" id="user-data" name="user-data" onclick=""/>
<br>
<button id="user-data-save">Save my choices</button>


<script>
    window.clearMindKaiserTrackingData = {};
    $(document).ready(function () {
        $.getJSON("input-formatted.json", function (json) {
            // console.log("success");
            // console.dir(json);
            window.clearMindKaiserTrackingData = json;

            json.forEach(function (el, cpt) {
                div_content = '<div id="row-' + cpt + '">';
                div_content += '<img alt="failed" src="https://kaisertracking.clearmind.studio/cache/' + el.picture_url.split('/').pop() + '.jpg">';
                div_content += '<span class="year">' + el.createdYear + '</span>' + el.title;
                div_content += '</div>';

                document.getElementById('movie-data').outerHTML += div_content;
            });
        })
            .fail(function () {
                console.log("error");
            });

        $('#user-data-save').on('click', function () {
            const userInput = $('#user-data').val();
            console.dir(userInput);
            $.ajax({
                url: 'save.php',
                type: 'POST',
                data: {data: userInput},
                success: function (response) {
                    try {
                        const json = JSON.parse(response);
                        if (json.success) {
                            console.info("Saved successfully: " + json.message);
                        } else {
                            console.debug("Error: " + json.message);
                        }
                    } catch (e) {
                        console.error("Invalid JSON response from server.");
                    }
                },
                error: function () {
                    alert("AJAX request failed.");
                }
            });
        });
    });
</script>
</body>
</html>